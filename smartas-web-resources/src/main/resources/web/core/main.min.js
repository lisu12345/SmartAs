+function(){var e=1,t={register:function(t){if(!t)return window;for(var n=t.split("."),r=window,i=0,u=n.length;u>i;i++)r=r[n[i]]||(r[n[i]]={__sn__:"pkg-sn-"+e++});return r},pkg:function(e){if(!e)return null;for(var t=e.split("."),n=window,r=null,i=0,u=t.length;u>i;i++)if(r=n,n=n[t[i]],!n)return null;return{pkg:n,parent:r,name:t[t.length-1]}}};$.extend(t.register("Smart.Namespace"),t)}(),+function(e,t){function n(e,t){this.name=e,this.ready=t||!1,this.watchers={}}n.prototype.on=function(e,t){void 0===t&&(t=e,e="defualt");var n=this.watchers[e]||(this.watchers[e]=[]);n.push(t),this.ready&&t()},n.prototype.fire=function(e,n){e=e||"defualt",t.each(this.watchers[e],function(e){e(n)})};var r=e.register("Smart.EventBus");r.New=function(e,t){return new n(e,t)}}(Smart.Namespace,_),+function(e){var t=e.register("Smart.ActionTypes");t.LINK={INPUT_CHANGE:"$$LINK_INPUT_CHANGE"},t.SERVICE={SUCCESS:"$$SERVICE_SUCCESS",ERROR:"$$SERVICE_ERROR",READY:"$$SERVICE_READY",REFRESH:"$$SERVICE_REFRESH",INIT:"$$SERVICE_INIT"}}(Smart.Namespace),function(e,t,n){function r(e){var t=e.dispatch,n=e.getState;return function(e){return function(r){return"function"==typeof r?r(t,n):e(r)}}}function i(e,t){return e}function u(e){return _.every(e,_.isPlainObject)}function o(e){return _.every(e,_.isFunction)}function a(){return g}function c(){return g.getState()}function s(e,t){function n(e,t){var n,i;if(!t)throw new Error("Action parameter value must be an object.");return t.type&&0===t.type.indexOf("@@")?e:(i={isActionHandled:!1},n=m(e,t,r,i),!i.isActionHandled&&t.type&&0===t.type.indexOf("$$")&&(n=m(n,t,u,i)),i.isActionHandled||"CONSTRUCT"===t.type||h.warn("Unhandled action '{0}'.",t.type),n)}var r={},u={};return r.global=i,r[t]=e,u[t]=v,function(e,t){return n(e,t)}}function f(e,t){return g.replaceReducer(s(e,t)),g}function l(e){var t=this.props;return{value:t.local.getIn(e),requestChange:function(t,r,i){g.dispatch({type:n.LINK.INPUT_CHANGE,key:e,value:t,input:i||"input",checked:r})}}}function p(e){return function(t){return ReactRedux.connect(function(t){var n=t.get(e)||Immutable.Map({}),r=t.get("global");return{get:_.bind(S.get,n),getIn:_.bind(S.getIn,n),local:{get:_.bind(S.get,n),getIn:_.bind(S.getIn,n)},global:{get:_.bind(S.get,r),getIn:_.bind(S.getIn,r)}}},t,null,{withRef:!0})}}var h=Log.getLogger("core.store"),d=Redux.applyMiddleware(r)(Redux.createStore),g=d(_.identity,Immutable.fromJS({global:{user:{userName:"chenjpu"}}})),v={$$LINK_INPUT_CHANGE:function(e,t){return e.updateIn(t.key.split("."),function(e){return"radio"===t.input||"checkbox"===t.input?t.checked?t.value:"":t.value})}},m=function(e,t,n,r){var i;return i=e,_.forEach(n,function(e,n){if(o(e)){if(e[t.type]){r.isActionHandled=!0;var a=e[t.type](i.get(n)||Immutable.Map({}),t);if(!Immutable.Iterable.isIterable(a))throw new Error('Reducer must return an instance of Immutable.Iterable. "'+n+'" domain "'+t.name+'" action handler result is "'+typeof a+'".');i=i.set(n,a)}}else u(e)&&(i=i.set(n,m(i.get(n)||Immutable.Map({}),t,e,r)))}),i},S={get:function(e){return this.get(e)},getIn:function(e){return this.getIn(e.split("."))}};_.extend(t.register("Smart.Store"),{getStore:a,getState:c,replaceReducer:f,linkState:l,connect:p})}($,Smart.Namespace,Smart.ActionTypes),function(e,t,n,r){function i(t){return e(t,o)}var u=Log.getLogger("core.resource.control"),o=e("#content"),a=n.New(!0),c={},s=Env.getInfo();e.fn.include=function(t,n,r){var i=t.indexOf("?"),o=this;return i>=0&&(t=t.substr(0,i)),e.isFunction(n)&&(r=n,n=void 0),t?(u.debug("request url '{0}'",t),void f.ajax({type:"get",url:t,dataType:"html",data:n,success:function(t){r&&r();var n=t.indexOf("/*[["),i=t.indexOf("]]*/");if(n>=0&&i>0){var a=[];a.push(t.substring(n+4,i)),a.push('<script type="text/{0}">'.format("dev"==s.profile?"babel":"javascript")),a.push(t.substr(i+4)),a.push("</script>"),t=a.join("")}var c=e(t);u.info("apply html segment to dom "),o.html(c),o.trigger("changed.dom")},error:function(){}})):(u.warn("request url is emtpy"),void(r&&r()))};var f=function(){var s={},l=function(e,a){var c=t.register(e);u.info("install package '{0}({1})'",e,c.__sn__);c.eventBus||(c.eventBus=n.New(e));a.call(c,i,o[0]);var l=c.ready&&c.ready(r.connect(e));if(l){l.WrappedComponent||(l=r.connect(e)(c.actions)(l));var p=c.reducers&&c.reducers(),h=r.replaceReducer(p,e);ReactDOM.render(React.createElement(ReactRedux.Provider,{store:h},React.createElement(l,{qs:f.getQs()})),o[0])}s[e]=c},p=function(n){var r=n?{namespace:null}:s;e.each(r,function(e){var n=t.pkg(e);n&&n.parent&&(u.info("uninstall package '{0}({1})'",e,n.pkg.__sn__),delete n.parent[n.name]),delete r[e]})},h=function(t){a.fire("before"),t.contentType="application/json",t.data&&!_.isString(t.data)&&(t.data=JSON.stringify(t.data));var n=t.complete;return t.complete=function(e,t){try{n&&n(e,t)}finally{a.fire("after")}},e.ajax(t)},d=function(e,t,n,r,i){_.isFunction(n)&&(i=r,r=n,n=void 0);var u={type:e,url:t,data:n,success:r,error:i};return h(u)};return{before:function(e){a.on("before",e)},after:function(e){a.on("after",e)},getQs:function(e){if(e){var t=location.hash;return Qs.parse(t.substr(t.indexOf("?")+1))}return c},install:l,uninstall:p,getCurrentUrl:function(){return f.hash},ajax:h,method:d,get:function(e,t,n,r){return d("get",e,t,n,r)},post:function(e,t,n,r){return d("post",e,t,n,r)},put:function(e,t,n,r){return d("put",e,t,n,r)},del:function(e,t,n,r){return d("delete",e,t,n,r)}}}();e.extend(t.register("Smart.Resource"),f),window.install=f.install,f.before(function(){ZENG.msgbox.show("正在加载中，请稍后...",6)}),f.after(function(){ZENG.msgbox.hide()}),e(window).hashchange(function(e){var t=location.hash;f.hash=t,c=Qs.parse(t.substr(t.indexOf("?")+1)),o.include(t.substr(2),function(){ReactDOM.unmountComponentAtNode(o[0]),f.uninstall()})})}($,Smart.Namespace,Smart.EventBus,Smart.Store),function(e,t,n){var r=t.register("Smart.DataSource");r.New=function(e,t,n){return new i(e,t,n)};var i=function(e,t,n){this.model=e,this.eventBus=t,this.options=n||{services:{create:"services/"+e+"/single",update:"services/"+e+"/single",get:"services/"+e+"/single/{0}",del:"services/"+e+"/single/{0}",listAll:"services/"+e+"/list",listPage:"services/"+e+"/list/{0}/{1}"}},this.options.services};i.prototype.get=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},u=["then","fail","done"],o=null,a=function(){return o=n.get(t.get.format(e)),_.each(u,function(e){o[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(u,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("get",e)}),a},i.prototype.del=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},u=["then","fail","done"],o=null,a=function(){return o=n.del(t.del.format(e)),_.each(u,function(e){o[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(u,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("refresh",e)}),a},i.prototype.create=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},u=["then","fail","done"],o=null,a=function(){return o=n.post(t.create,e),_.each(u,function(e){o[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(u,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("refresh",e)}),a},i.prototype.update=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},u=["then","fail","done"],o=null,a=function(){return o=n.put(t.update,e),_.each(u,function(e){o[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(u,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("refresh",e)}),a},i.prototype.listPage=function(e,t,r){var i=this.options.services,u=this.eventBus,o={then:[],fail:[],done:[]},a=["then","fail","done"],c=null,s=function(){return c=n.get(i.listPage.format(e,t),r),_.each(a,function(e){c[e](function(t){_.each(o[e],function(e){e(t)})})}),s};return _.each(a,function(e){s[e]=function(t){return o[e].push(t),s}}),s.then(function(e){u.fire("list",e)}),s},i.prototype.listAll=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},u=["then","fail","done"],o=null,a=function(){return o=n.get(t.listAll,e),_.each(u,function(e){o[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(u,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("list",e)}),a},i.prototype.refresh=function(e){return this.eventBus.fire("refresh"),this},i.prototype.onRefresh=function(e){return this.eventBus.on("refresh",e),this},i.prototype.onList=function(e){return this.eventBus.on("list",e),this},i.prototype.onGet=function(e){return this.eventBus.on("get",e),this}}($,Smart.Namespace,Smart.Resource),function(e,t,n,r){function i(e){var t=_.slice(arguments,1);return function(e,n,r){_.each(t,function(t){return t?t(e,n,r):void 0})}}var u=t.register("Smart.Service");u.New=function(e){function t(e){m.push(e);var t=!0;return function(){if(t){t=!1;var n=m.indexOf(e);m.splice(n,1)}}}function u(e){_.each(m,function(t){t(e)})}function o(e,t,n){return E("create","post",S.create,e,t,n)}function a(e,t,n){return E("update","put",S.update,e,t,n)}function c(e,t,n){return E("get","get",S.get.format(e),t,n)}function s(e,t,n){return E("find","get",S.find.format(e),t,n)}function f(e,t,n){return E("remove","delete",S.remove.format(e),t,n)}function l(e,t,n){return E("list","get",S.list,e,t,n)}function p(e,t,n,r,i){return E("listPage","get",S.listPage.format(e,t),n,r,i)}function h(){v(r.SERVICE.READY)}function d(){v(r.SERVICE.INIT)}function g(){arguments.length?v(r.SERVICE.REFRESH,{page:arguments[0],pageSize:arguments[1],q:arguments[2]}):v(r.SERVICE.REFRESH)}function v(e,t){u({type:e,data:t})}var m=[],S={create:"services/"+e+"/single",update:"services/"+e+"/single",get:"services/"+e+"/single/{0}",find:"services/"+e+"/single/{0}",remove:"services/"+e+"/single/{0}",list:"services/"+e+"/list",listPage:"services/"+e+"/list/{0}/{1}"},E=function(t,o,a,c,s,f){return n.method(o,a,c,i(o,function(n){u({type:r.SERVICE.SUCCESS,method:t,model:e,data:n})},s),f)};return{create:o,update:a,get:c,find:s,remove:f,list:l,listPage:p,dispatch:v,ready:h,init:d,refresh:g,subscribe:t}}}($,Smart.Namespace,Smart.Resource,Smart.ActionTypes);