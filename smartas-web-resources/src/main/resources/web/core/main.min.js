+function(){var e=1,t={register:function(t){if(!t)return window;for(var n=t.split("."),r=window,i=0,o=n.length;o>i;i++)r=r[n[i]]||(r[n[i]]={__sn__:"pkg-sn-"+e++});return r},pkg:function(e){if(!e)return null;for(var t=e.split("."),n=window,r=null,i=0,o=t.length;o>i;i++)if(r=n,n=n[t[i]],!n)return null;return{pkg:n,parent:r,name:t[t.length-1]}}};$.extend(t.register("Smart.Namespace"),t)}(),+function(e,t){function n(e,t){this.name=e,this.ready=t||!1,this.watchers={}}n.prototype.on=function(e,t){void 0===t&&(t=e,e="defualt");var n=this.watchers[e]||(this.watchers[e]=[]);n.push(t),this.ready&&t()},n.prototype.fire=function(e,n){e=e||"defualt",t.each(this.watchers[e],function(e){e(n)})};var r=e.register("Smart.EventBus");r.New=function(e,t){return new n(e,t)}}(Smart.Namespace,_),+function(e){var t=e.register("Smart.ActionTypes");t.LINK={INPUT_CHANGE:"$$LINK_INPUT_CHANGE"},t.SERVICE={SUCCESS:"$$SERVICE_SUCCESS",ERROR:"$$SERVICE_ERROR",READY:"$$SERVICE_READY",REFRESH:"$$SERVICE_REFRESH",INIT:"$$SERVICE_INIT"}}(Smart.Namespace),function(e,t,n){function r(e){var t=e.dispatch,n=e.getState;return function(e){return function(r){return"function"==typeof r?r(t,n):e(r)}}}function i(e,t){return e}function o(e){return _.every(e,_.isPlainObject)}function u(e){return _.every(e,_.isFunction)}function a(){return v}function s(){return v.getState()}function c(e,t){function n(e,t){var n,i;if(!t)throw new Error("Action parameter value must be an object.");return t.type&&0===t.type.indexOf("@@")?e:(i={isActionHandled:!1},n=S(e,t,r,i),!i.isActionHandled&&t.type&&0===t.type.indexOf("$$")&&(n=S(n,t,o,i)),i.isActionHandled||"CONSTRUCT"===t.type||d.warn("Unhandled action '{0}'.",t.type),n)}var r={},o={};return r.global=i,r[t]=e,o[t]=m,function(e,t){return n(e,t)}}function f(e,t){return v.replaceReducer(c(e,t)),v}function l(e,t){return{value:t.getIn(e),requestChange:function(t,r,i){v.dispatch({type:n.LINK.INPUT_CHANGE,key:e,value:t,input:i||"input",checked:r})}}}function p(e){return l(e,this.props.local)}function h(e){return function(t){return ReactRedux.connect(function(t){var n=t.get(e)||Immutable.Map({}),r=t.get("global"),i=_.bind(y.getIn,n),o=_.bind(y.get,n),u={get:o,getIn:i};return{get:o,getIn:i,linkState:function(e){return l(e,u)},local:u,global:{get:_.bind(y.get,r),getIn:_.bind(y.getIn,r)}}},t,null,{withRef:!0})}}var d=Log.getLogger("core.store"),g=Redux.applyMiddleware(r)(Redux.createStore),v=g(_.identity,Immutable.fromJS({global:{user:{userName:"chenjpu"}}})),m={$$LINK_INPUT_CHANGE:function(e,t){return e.updateIn(t.key.split("."),function(e){return"radio"===t.input||"checkbox"===t.input?t.checked?t.value:"":t.value})}},S=function(e,t,n,r){var i;return i=e,_.forEach(n,function(e,n){if(u(e)){if(e[t.type]){r.isActionHandled=!0;var a=e[t.type](i.get(n)||Immutable.Map({}),t);if(!Immutable.Iterable.isIterable(a))throw new Error('Reducer must return an instance of Immutable.Iterable. "'+n+'" domain "'+t.name+'" action handler result is "'+typeof a+'".');i=i.set(n,a)}}else o(e)&&(i=i.set(n,S(i.get(n)||Immutable.Map({}),t,e,r)))}),i},y={get:function(e){return this.get(e)},getIn:function(e){return this.getIn(e.split("."))}};_.extend(t.register("Smart.Store"),{getStore:a,getState:s,replaceReducer:f,linkState:p,connect:h})}($,Smart.Namespace,Smart.ActionTypes),function(e,t,n,r){function i(t){return e(t,u)}var o=Log.getLogger("core.resource.control"),u=e("#content"),a=n.New(!0),s={},c=Env.getInfo();e.ajaxSetup({cache:!1}),e.fn.include=function(t,n,r){var i=t.indexOf("?"),u=this;return i>=0&&(t=t.substr(0,i)),e.isFunction(n)&&(r=n,n=void 0),t?(o.debug("request url '{0}'",t),f.ajax({beforeSend:function(e){e.setRequestHeader("X-Requested-URL",t)},type:"get",url:t,dataType:"html",data:n,success:function(t){r&&r();var n=t.indexOf("/*[["),i=t.indexOf("]]*/");if(n>=0&&i>0){var a=[];a.push(t.substring(n+4,i)),a.push('<script type="text/{0}">'.format("dev"==c.profile?"babel":"javascript")),a.push(t.substr(i+4)),a.push("</script>"),t=a.join("")}try{var s=e(t);o.info("apply html segment to dom "),u.html(s),u.trigger("changed.dom")}catch(f){throw o.error("apply html {0}",f),f}}})):(o.warn("request url is emtpy"),void(r&&r()))};var f=function(){var c={},l=function(e,a){var s=t.register(e);o.info("install package '{0}({1})'",e,s.__sn__);s.eventBus||(s.eventBus=n.New(e));a.call(s,i,u[0]);var l=s.ready&&s.ready(r.connect(e));if(l){l.WrappedComponent||(l=r.connect(e)(s.actions)(l));var p=s.reducers&&s.reducers(),h=r.replaceReducer(p,e);ReactDOM.render(React.createElement(ReactRedux.Provider,{store:h},React.createElement(l,{qs:f.getQs(),link:function(){}})),u[0])}c[e]=s},p=function(n){var r=n?{namespace:null}:c;e.each(r,function(e){var n=t.pkg(e);n&&n.parent&&(o.info("uninstall package '{0}({1})'",e,n.pkg.__sn__),delete n.parent[n.name]),delete r[e]})},h=function(t){a.fire("before");var n=t.data,r=t.type;"put"!=r&&"post"!=r||!n||_.isString(n)||(t.contentType="application/json;charset=UTF-8",t.data=JSON.stringify(n));var i=t.complete;return t.statusCode={403:function(){Smart.UI.message.error("无权操作")},400:function(e){}},t.complete=function(e,n){try{var r=e.getResponseHeader("X-Session-Status");if("timeout"==r)t.complete=i,a.fire("timeout",t);else if("error"===n){var u=e.responseJSON;u&&(u.stackTrace&&o.error(u.stackTrace),Smart.UI.message.error(u.message))}i&&i(e,n)}finally{a.fire("after")}},e.ajax(t)},d=function(e,t,n,r,i){_.isFunction(n)&&(i=r,r=n,n=void 0);var o={type:e,url:t,data:n,success:r,error:i};return h(o)};return{before:function(e){a.on("before",e)},after:function(e){a.on("after",e)},on:function(e,t){a.on(e,t)},fire:function(e,t){a.fire(e,t)},getQs:function(e){if(e){var t=location.hash;return Qs.parse(t.substr(t.indexOf("?")+1))}return s},install:l,uninstall:p,getCurrentUrl:function(){return f.hash},ajax:h,method:d,get:function(e,t,n,r){return d("get",e,t,n,r)},post:function(e,t,n,r){return d("post",e,t,n,r)},put:function(e,t,n,r){return d("put",e,t,n,r)},del:function(e,t,n,r){return d("delete",e,t,n,r)}}}();e.extend(t.register("Smart.Resource"),f),window.install=f.install,f.before(function(){ZENG.msgbox.show("正在加载中，请稍后...",6)}),f.after(function(){ZENG.msgbox.hide()}),e(window).hashchange(function(e){var t,n=location.hash;f.hash=n,s=Qs.parse(n.substr(n.indexOf("?")+1)),t=u.include(n.substr(2),function(){ReactDOM.unmountComponentAtNode(u[0]),f.uninstall()})})}($,Smart.Namespace,Smart.EventBus,Smart.Store),function(e,t,n){var r=t.register("Smart.DataSource");r.New=function(e,t,n){return new i(e,t,n)};var i=function(e,t,n){this.model=e,this.eventBus=t,this.options=n||{services:{create:"services/"+e+"/single",update:"services/"+e+"/single",get:"services/"+e+"/single/{0}",del:"services/"+e+"/single/{0}",listAll:"services/"+e+"/list",listPage:"services/"+e+"/list/{0}/{1}"}},this.options.services};i.prototype.get=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},o=["then","fail","done"],u=null,a=function(){return u=n.get(t.get.format(e)),_.each(o,function(e){u[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(o,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("get",e)}),a},i.prototype.del=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},o=["then","fail","done"],u=null,a=function(){return u=n.del(t.del.format(e)),_.each(o,function(e){u[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(o,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("refresh",e)}),a},i.prototype.create=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},o=["then","fail","done"],u=null,a=function(){return u=n.post(t.create,e),_.each(o,function(e){u[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(o,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("refresh",e)}),a},i.prototype.update=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},o=["then","fail","done"],u=null,a=function(){return u=n.put(t.update,e),_.each(o,function(e){u[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(o,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("refresh",e)}),a},i.prototype.listPage=function(e,t,r){var i=this.options.services,o=this.eventBus,u={then:[],fail:[],done:[]},a=["then","fail","done"],s=null,c=function(){return s=n.get(i.listPage.format(e,t),r),_.each(a,function(e){s[e](function(t){_.each(u[e],function(e){e(t)})})}),c};return _.each(a,function(e){c[e]=function(t){return u[e].push(t),c}}),c.then(function(e){o.fire("list",e)}),c},i.prototype.listAll=function(e){var t=this.options.services,r=this.eventBus,i={then:[],fail:[],done:[]},o=["then","fail","done"],u=null,a=function(){return u=n.get(t.listAll,e),_.each(o,function(e){u[e](function(t){_.each(i[e],function(e){e(t)})})}),a};return _.each(o,function(e){a[e]=function(t){return i[e].push(t),a}}),a.then(function(e){r.fire("list",e)}),a},i.prototype.refresh=function(e){return this.eventBus.fire("refresh"),this},i.prototype.onRefresh=function(e){return this.eventBus.on("refresh",e),this},i.prototype.onList=function(e){return this.eventBus.on("list",e),this},i.prototype.onGet=function(e){return this.eventBus.on("get",e),this}}($,Smart.Namespace,Smart.Resource),function(e,t,n,r){function i(e){var t=_.slice(arguments,1);return function(e,n,r){_.each(t,function(t){return t?t(e,n,r):void 0})}}var o=t.register("Smart.Service");o.New=function(e,t){function o(e){S.push(e);var t=!0;return function(){if(t){t=!1;var n=S.indexOf(e);S.splice(n,1)}}}function u(e){_.each(S,function(t){t(e)})}function a(e,t,n,r){return _.isFunction(t)&&(r=n,n=t,t=void 0),E("create","post",!0,t||y.create,e,n,r)}function s(e,t,n,r){return _.isFunction(t)&&(r=n,n=t,t=void 0),E("update","put",!0,t||y.update,e,n,r)}function c(e,t,n,r){return _.isFunction(t)&&(r=n,n=t,t=void 0),_.isArray(e)?E("get","get",!1,t||y.get.format("batach",_.join(e)),n,r):E("get","get",!1,t||y.get.format("single",e),n,r)}function f(e,t,n,r){return _.isFunction(t)&&(r=n,n=t,t=void 0),E("find","get",!1,t||y.find.format(e),n,r)}function l(e,t,n,r){return _.isFunction(t)&&(r=n,n=t,t=void 0),_.isArray(e)?E("remove","delete",!0,t||y.remove.format("batach",_.join(e)),n,r):E("remove","delete",!0,t||y.get.format("single",e),n,r)}function p(e,t,n,r){return _.isFunction(t)&&(r=n,n=t,t=void 0),E("list","get",!1,t||y.list.format(e?"query":"list"),e,n,r)}function h(e,t,n,r,i,o){return _.isFunction(r)&&(o=i,i=r,r=void 0),E("listPage","get",!1,r||y.listPage.format(n?"query":"list",e,t),n,i,o)}function d(){m(r.SERVICE.READY,void 0,"ready")}function g(){m(r.SERVICE.INIT,void 0,"init")}function v(){arguments.length?m(r.SERVICE.REFRESH,{page:arguments[0],pageSize:arguments[1],q:arguments[2]},"refresh"):m(r.SERVICE.REFRESH,void 0,"refresh")}function m(e,t,n){u({type:e,method:n,data:t})}"/"==e.charAt(0)&&(e=e.substring(1));var S=[],y={create:"services/"+e+"/single",update:"services/"+e+"/single",get:"services/"+e+"/{0}/{1}",find:"services/"+e+"/single/{0}",remove:"services/"+e+"/{0}/{1}",list:"services/"+e+"/{0}",listPage:"services/"+e+"/{0}/{1}/{2}"},E=function(t,o,a,s,c,f,l){return _.isFunction(c)&&(l=f,f=c,c=void 0),n.method(o,s,c,i(o,function(n){u({type:r.SERVICE.SUCCESS,method:t,notify:a,model:e,data:n})},f),l)};return(t||void 0===t)&&S.push(function(e){e.notify&&v()}),{create:a,update:s,get:c,find:f,remove:l,list:p,listPage:h,dispatch:m,ready:d,init:g,refresh:v,subscribe:o}}}($,Smart.Namespace,Smart.Resource,Smart.ActionTypes);