<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.fiberhome.smartas.security.dao.PermissionDao">
	  
	<!-- <cache /> -->
	
	<!-- ///////////////////////////基础接口定义///////////////////////////////// -->
	
	  
	<!-- //////////////////////////////////////////////////////////// -->
	  
	  
	<delete id="delPermsByRoleId">
	    DELETE FROM  tpl_app_role_perms_t
	    WHERE role_id = #{id}
	</delete>
	<insert id="insertPerms" databaseId="mysql">
	 	INSERT INTO tpl_app_role_perms_t VALUES
		<foreach item="perm" collection="perms" separator="," >
       		(#{roleId}, #{perm})
		</foreach>
	</insert>
	<insert id="insertPerms"  databaseId="oracle">
		INSERT INTO tpl_app_role_perms_t
		<foreach item="perm" collection="perms" separator="union">
       		(SELECT #{roleId}, #{perm} FROM DUAL)
		</foreach>
	</insert>
	<select id="getPermissionsByRoleId" resultType="string">
		SELECT
		T.code
		FROM tpl_app_role_perms_t T
		WHERE T.role_id = #{id}
	</select>
	
	<select id="findPermissionsByUserId" resultType="string">
		SELECT
		distinct(T.code)
		FROM tpl_app_role_perms_t T
		WHERE T.role_id in (
			SELECT
		       T.roleId
		    FROM tpl_user_role_t T 
		    WHERE T.userId = #{userId}
	    )
	</select>
	
	  
	
</mapper>

